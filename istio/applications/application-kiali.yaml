apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
    name: kiali
    namespace: argocd
spec:
    project: istio
    sources:
        - repoURL: https://github.com/SDB016/argo-demo.git
          targetRevision: HEAD
          path: istio/addons
        - repoURL: https://kiali.org/helm-charts
          chart: kiali-operator
          targetRevision: 1.76.0
          helm:
            valueFiles:
                - values.yaml
            values: |
              cr:
                create: true
                namespace: istio-system
                spec:
                    auth:
                        strategy: anonymous
            externalValueFiles:
                - repoURL: https://github.com/SDB016/argo-demo.git
                  targetRevision: HEAD
                  valueFiles:
                    - istio/values/kiali-values.yaml
    destination:
        server: https://kubernetes.default.svc
        namespace: istio-system
    syncPolicy:
        automated:
            prune: true
            selfHeal: true
        syncOptions:
        - CreateNamespace=true